<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Monster Visual Test</title>
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.60.0/dist/phaser.js"></script>
    <style>
        body {
            margin: 0;
            padding: 20px;
            background: #1a1a2e;
            color: white;
            font-family: Arial, sans-serif;
        }
        #info {
            margin-bottom: 20px;
            padding: 10px;
            background: #16213e;
            border-radius: 5px;
        }
        canvas {
            display: block;
            margin: 0 auto;
            border: 2px solid #0f3460;
        }
    </style>
</head>
<body>
    <div id="info">
        <h2>ğŸ® Monster Visual Test</h2>
        <p>ê° íƒ€ì…ë³„ ëª¬ìŠ¤í„°ê°€ ì œëŒ€ë¡œ í‘œì‹œë˜ëŠ”ì§€ í…ŒìŠ¤íŠ¸í•©ë‹ˆë‹¤.</p>
        <p>ë³´ì—¬ì•¼ í•  ê²ƒ:</p>
        <ul>
            <li><strong>Attacker:</strong> ë¿”ì´ ìˆëŠ” ê³µê²©í˜• (ë¹¨ê°„ ë¿”)</li>
            <li><strong>Defender:</strong> ë‹¤ë¦¬ì™€ ê°€ë¡œ ì¤„ íŒ¨í„´ì´ ìˆëŠ” ë°©ì–´í˜•</li>
            <li><strong>Speeder:</strong> ë‚ ê°œê°€ ìˆëŠ” ì†ë„í˜• (ë¶„í™ ë‚ ê°œ)</li>
        </ul>
    </div>

    <script type="module">
        // Constants
        const DEPTH = {
            BACKGROUND: 0,
            MONSTER: 10,
            UI: 100
        };

        // Monster Data
        const MONSTER_STATS = {
            common: { width: 40, height: 60, color: 0x8B4513, hp: 100, attackDamage: 20, speed: 50, attackRange: 30, attackCooldown: 1000 },
            rare: { width: 50, height: 70, color: 0x4169E1, hp: 200, attackDamage: 40, speed: 40, attackRange: 40, attackCooldown: 1200 },
            epic: { width: 60, height: 80, color: 0x9932CC, hp: 350, attackDamage: 60, speed: 35, attackRange: 50, attackCooldown: 1500 }
        };

        const MONSTER_TYPE_MODIFIERS = {
            attacker: { attackDamage: 1.5, hp: 0.8, speed: 1.0 },
            defender: { attackDamage: 0.8, hp: 1.5, speed: 0.8 },
            speeder: { attackDamage: 0.7, hp: 0.6, speed: 1.8 }
        };

        function calculateMonsterStats(grade, type) {
            const baseStats = MONSTER_STATS[grade] || MONSTER_STATS.common;
            const modifiers = MONSTER_TYPE_MODIFIERS[type] || MONSTER_TYPE_MODIFIERS.attacker;
            return {
                ...baseStats,
                hp: Math.floor(baseStats.hp * modifiers.hp),
                attackDamage: Math.floor(baseStats.attackDamage * modifiers.attackDamage),
                speed: baseStats.speed * modifiers.speed
            };
        }

        // Monster Class
        class TestMonster extends Phaser.GameObjects.Container {
            constructor(scene, x, y, team, grade, type) {
                super(scene, x, y);

                this.scene = scene;
                this.team = team;
                this.grade = grade;
                this.type = type;

                const stats = calculateMonsterStats(grade, type);
                this.hp = stats.hp;
                this.maxHp = stats.hp;
                this.width = stats.width;
                this.height = stats.height;
                this.color = stats.color;

                console.log(`Creating ${team} ${grade} ${type} monster at (${x}, ${y})`);
                console.log(`Size: ${this.width}x${this.height}, Color: ${this.color.toString(16)}`);

                this.createVisuals();
                this.setDepth(DEPTH.MONSTER);
            }

            createVisuals() {
                const w = this.width;
                const h = this.height;
                const color = this.color;

                console.log(`Creating visuals for ${this.type}: w=${w}, h=${h}, color=${color.toString(16)}`);

                // íƒ€ì…ë³„ ëª¬ìŠ¤í„° í˜•íƒœ ê·¸ë¦¬ê¸°
                if (this.type === 'attacker') {
                    this.createAttackerVisuals(w, h, color);
                } else if (this.type === 'defender') {
                    this.createDefenderVisuals(w, h, color);
                } else if (this.type === 'speeder') {
                    this.createSpeederVisuals(w, h, color);
                }

                // ì²´ë ¥ ë°” ë°°ê²½
                this.hpBarBg = this.scene.add.rectangle(0, h / 2 + 10, w, 6, 0x333333);
                this.add(this.hpBarBg);

                // ì²´ë ¥ ë°”
                this.hpBar = this.scene.add.rectangle(0, h / 2 + 10, w, 6, 0x00FF00);
                this.add(this.hpBar);

                // íƒ€ì… ë¼ë²¨
                const label = this.scene.add.text(0, -h / 2 - 15, `${this.type}`, {
                    fontSize: '12px',
                    fontFamily: 'Arial',
                    color: '#ffffff',
                    fontStyle: 'bold'
                }).setOrigin(0.5);
                this.add(label);

                console.log(`Added ${this.list.length} children to container`);
            }

            createAttackerVisuals(w, h, color) {
                console.log('Creating Attacker visuals');

                // ëª¸í†µ (ìƒë‹¨)
                const body = this.scene.add.rectangle(0, -h * 0.15, w * 0.75, h * 0.35, color);
                this.add(body);

                // í•˜ë‹¨
                const bottom = this.scene.add.rectangle(0, h * 0.25, w * 0.65, h * 0.25, color);
                this.add(bottom);

                // ì™¼ìª½ ë¿”
                const leftHorn = this.scene.add.polygon(-w * 0.35, -h * 0.25, [[-4, -6], [-1, 2], [3, -1]]);
                leftHorn.setFillStyle(0xFF6666);
                this.add(leftHorn);

                // ì˜¤ë¥¸ìª½ ë¿”
                const rightHorn = this.scene.add.polygon(w * 0.35, -h * 0.25, [[4, -6], [1, 2], [-3, -1]]);
                rightHorn.setFillStyle(0xFF6666);
                this.add(rightHorn);

                // ëˆˆ
                const eye = this.scene.add.circle(0, -h * 0.05, 2.5, 0xFFFFFF);
                this.add(eye);
            }

            createDefenderVisuals(w, h, color) {
                console.log('Creating Defender visuals');

                // í° ëª¸í†µ (ë°©íŒ¨ ëª¨ì–‘)
                const body = this.scene.add.rectangle(0, -h * 0.1, w * 0.85, h * 0.5, color);
                this.add(body);

                // í•˜ë‹¨ ë‹¤ë¦¬ (ì™¼ìª½)
                const leftLeg = this.scene.add.rectangle(-w * 0.2, h * 0.3, w * 0.25, h * 0.15, color);
                this.add(leftLeg);

                // í•˜ë‹¨ ë‹¤ë¦¬ (ì˜¤ë¥¸ìª½)
                const rightLeg = this.scene.add.rectangle(w * 0.2, h * 0.3, w * 0.25, h * 0.15, color);
                this.add(rightLeg);

                // ë°©ì–´ íŒ¨í„´ (ê°€ë¡œ ì¤„)
                for (let i = 0; i < 3; i++) {
                    const line = this.scene.add.rectangle(0, -h * 0.25 + i * 0.2 * h, w * 0.6, 2, 0x8888FF);
                    this.add(line);
                }

                // ëˆˆ (ì™¼ìª½)
                const leftEye = this.scene.add.circle(-w * 0.15, -h * 0.15, 2.5, 0xFFFFFF);
                this.add(leftEye);

                // ëˆˆ (ì˜¤ë¥¸ìª½)
                const rightEye = this.scene.add.circle(w * 0.15, -h * 0.15, 2.5, 0xFFFFFF);
                this.add(rightEye);
            }

            createSpeederVisuals(w, h, color) {
                console.log('Creating Speeder visuals');

                // ì•ìª½ ë¾°ì¡±í•œ ë¶€ë¶„
                const front = this.scene.add.polygon(-w * 0.25, 0, [[-6, -5], [0, 0], [-6, 5]]);
                front.setFillStyle(color);
                this.add(front);

                // ë©”ì¸ ë°”ë””
                const body = this.scene.add.rectangle(0, 0, w * 0.65, h * 0.3, color);
                this.add(body);

                // ë’¤ìª½ ë‚ ê°œ (ìœ„ìª½)
                const topWing = this.scene.add.polygon(w * 0.2, -h * 0.15, [[0, -4], [5, 0], [2, 4]]);
                topWing.setFillStyle(0xFF88FF);
                this.add(topWing);

                // ë’¤ìª½ ë‚ ê°œ (ì•„ë˜ìª½)
                const bottomWing = this.scene.add.polygon(w * 0.2, h * 0.15, [[0, -4], [5, 0], [2, 4]]);
                bottomWing.setFillStyle(0xFF88FF);
                this.add(bottomWing);

                // ì†ë„ê° ì„  (í˜ëŸ¬ê°€ëŠ” íš¨ê³¼)
                const speedLine = this.scene.add.rectangle(-w * 0.3, 0, w * 0.3, 2, 0xFF88FF);
                this.add(speedLine);

                // ëˆˆ
                const eye = this.scene.add.circle(-w * 0.15, -h * 0.1, 2, 0xFFFFFF);
                this.add(eye);
            }
        }

        // Test Scene
        class TestScene extends Phaser.Scene {
            constructor() {
                super({ key: 'TestScene' });
            }

            create() {
                const { width, height } = this.scale;

                // ë°°ê²½
                this.add.rectangle(width / 2, height / 2, width, height, 0x1a1a2e);

                // íƒ€ì´í‹€
                this.add.text(width / 2, 30, 'Monster Visual Test', {
                    fontSize: '24px',
                    fontFamily: 'Arial',
                    color: '#ffffff',
                    fontStyle: 'bold'
                }).setOrigin(0.5);

                // í…ŒìŠ¤íŠ¸í•  ëª¬ìŠ¤í„° ë°°ì—´
                const monsters = [
                    { grade: 'common', type: 'attacker', x: 150, y: 150, team: 'player' },
                    { grade: 'rare', type: 'defender', x: 350, y: 150, team: 'player' },
                    { grade: 'epic', type: 'speeder', x: 550, y: 150, team: 'player' },

                    { grade: 'common', type: 'defender', x: 150, y: 300, team: 'ai' },
                    { grade: 'rare', type: 'speeder', x: 350, y: 300, team: 'ai' },
                    { grade: 'epic', type: 'attacker', x: 550, y: 300, team: 'ai' }
                ];

                console.log('Creating test monsters...');

                monsters.forEach(config => {
                    const monster = new TestMonster(
                        this,
                        config.x,
                        config.y,
                        config.team,
                        config.grade,
                        config.type
                    );
                    this.add.existing(monster);

                    // ë¼ë²¨
                    this.add.text(config.x, config.y + 60,
                        `${config.grade}\n${config.type}\n${config.team}`,
                        {
                            fontSize: '10px',
                            fontFamily: 'Arial',
                            color: '#aaaaaa',
                            align: 'center'
                        }
                    ).setOrigin(0.5);
                });

                console.log('Test scene created successfully');
            }
        }

        // Game Config
        const config = {
            type: Phaser.AUTO,
            width: 700,
            height: 400,
            backgroundColor: '#1a1a2e',
            scene: TestScene
        };

        const game = new Phaser.Game(config);
    </script>
</body>
</html>
